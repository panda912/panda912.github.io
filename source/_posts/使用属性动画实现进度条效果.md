---
title: 使用属性动画实现进度条效果
date: 2016-12-30 14:01:20
tags: 动画
---

### 参考链接：

http://blog.csdn.net/AndroidMsky/article/details/50239447

最近项目中要做一个显示进度的效果，设计给了我们每个阶段的切图，只要根据数据显示不同的图片就可以了，后来空闲的时候就想着把它做成动态的效果，以前无意间看到上面的文章，正好在这里用到，实现方式比较简单，就三层`View`，最底层是绿色的`View`，中间一层是灰色的`View`，最上层就是一个空心的`ImageView`，使用属性动画控制中间灰色的`View`向右平移，最底层绿色就会显示出来，从而实现动态进度条的效果。至于底部的文字，就是 `LinearLayout` 四等分，在`addUpdateListener`中获取动画当前的`value`，动态设置文字的颜色。

![](https://ws3.sinaimg.cn/large/ad5b14bfgw1fb8rj4os0dj20he00z0sn.jpg)

![](https://ws2.sinaimg.cn/large/ad5b14bfgw1fb8nweytb1g207i0dcwvr.gif)

### 代码片段：

```java
// mProgressMaskView 中间灰色遮罩层View
// mProgressDrawableWidth 进度条的宽度
// state 服务器返回的字段 1、2、3、4，对应每一个阶段
final int state = StringConversionUtil.parseInt(obj.ob_state, 1);
if (mProgressAnimator == null) {
    mProgressAnimator = ObjectAnimator.ofFloat(mProgressMaskView, "translationX", 0, mProgressDrawableWidth * state / 4);
    mProgressAnimator.addUpdateListener(new ValueAnimator.AnimatorUpdateListener() {
        @Override
        public void onAnimationUpdate(ValueAnimator animation) {
            float value = (float) animation.getAnimatedValue();
            int index = (int) (value / (mProgressDrawableWidth / 4));
            //设置底部文字的颜色
            ((TextView) mProgressInfoLL.getChildAt(Math.min(index, state - 1))).setTextColor(getResources().getColor(R.color.toolbar_green));
        }
    });
    mProgressAnimator.setDuration(1000);
} else {
    mProgressAnimator.setFloatValues(0, mProgressDrawableWidth * state / 4);
}
if (!mProgressAnimator.isRunning()) {
    mProgressAnimator.start();
}
```